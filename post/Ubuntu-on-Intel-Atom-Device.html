<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Installing Ubuntu on Intel Atom Devices - Laurens' geeky adventures</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.laurens.xyz/post/Ubuntu-on-Intel-Atom-Device.html">

        <meta name="author" content="Laurens" />
        <meta name="keywords" content="Ubuntu,Beelink,Intel Atom,Install" />
        <meta name="description" content="A month or two ago I bought myself a new device to replace my faithfull Raspberry Pi 3. I made the change for several reasons. Among those reasons are the lack of RAM, the lack of supported video types, lack of USB 3 and the fact that the (slow) LAN ..." />

        <meta property="og:site_name" content="Laurens' geeky adventures" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Installing Ubuntu on Intel Atom Devices"/>
        <meta property="og:url" content="https://blog.laurens.xyz/post/Ubuntu-on-Intel-Atom-Device.html"/>
        <meta property="og:description" content="A month or two ago I bought myself a new device to replace my faithfull Raspberry Pi 3. I made the change for several reasons. Among those reasons are the lack of RAM, the lack of supported video types, lack of USB 3 and the fact that the (slow) LAN ..."/>
        <meta property="article:published_time" content="2017-07-10" />
            <meta property="article:section" content="2017" />
            <meta property="article:tag" content="Ubuntu" />
            <meta property="article:tag" content="Beelink" />
            <meta property="article:tag" content="Intel Atom" />
            <meta property="article:tag" content="Install" />
            <meta property="article:author" content="Laurens" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.laurens.xyz/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="https://blog.laurens.xyz/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.laurens.xyz/theme/css/pygments/zenburn.css" rel="stylesheet">
    <link href="https://blog.laurens.xyz/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.laurens.xyz/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.laurens.xyz/" class="navbar-brand">
Laurens' geeky adventures            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li ><a href="https://blog.laurens.xyz/tags.html">Tags</a></li>
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://blog.laurens.xyz/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.laurens.xyz/post/Ubuntu-on-Intel-Atom-Device.html"
                       rel="bookmark"
                       title="Permalink to Installing Ubuntu on Intel Atom Devices">
                        Installing Ubuntu on Intel Atom Devices
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-07-10T19:46:00+02:00"> 10-07-2017</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://blog.laurens.xyz/tags/ubuntu.html">Ubuntu</a>
        /
	<a href="https://blog.laurens.xyz/tags/beelink.html">Beelink</a>
        /
	<a href="https://blog.laurens.xyz/tags/intel-atom.html">Intel Atom</a>
        /
	<a href="https://blog.laurens.xyz/tags/install.html">Install</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>A month or two ago I bought myself a new device to replace my faithfull Raspberry Pi 3. I made the change for several reasons. Among those reasons are the lack of RAM, the lack of supported video types, lack of USB 3 and the fact that the (slow) LAN port shared a controller with all USB ports. Don't get me wrong, the RPi3 is a great device, it just couldn't be the media server that I once hoped it to be. Hence, I got interested in cheap and low-powered Intel Atom devices. The <a href="http://www.bee-link.com/Beelink-MiniPC-TV-BOX-66-1.html">Beelink AP42</a> caught my eye in particular due to it's fanless and therefore silent design. It would be the ultimate low-power media center.</p>
<p>After receiving this unit, I quickly realized that installing Linux would be quite the task. Pretty much all installation images of Linux distributions would not boot for reason that are still unclear to me. This was quite the bummer because manufacturers of these Intel Atom devices advertise Linux support. None of them actually provides the support themselves. After sinking plenty of hours in getting this little baby to work, I finally have a working Ubuntu system. In this blog post I will share the secret to the world so that everyone can enjoy these amazing devices to the fullest. This guide certainly works for installing Ubuntu to the Beelink AP42, but it will most likely work for similar Atom-based devices too (Beelink AP34, VOYO V1 Vmac).</p>
<h1>Preparing the installation image</h1>
<p>One should start with downloading the official Ubuntu image. Another Ubuntu flavour should work <em>in theory</em>, however I found that in other distro's that the HDMI audio passtrough would not work. If audio over HDMI is not a concern to you and you can use the audiojack instead, then go ahead. In any other case, I recommend starting with the full Ubuntu distro and then replace the default unity desktop with the desktop of another distro (Xubuntu, Lubuntu, ...) using the package manager.</p>
<p>Once you have chosen a version(Ubuntu 17.04 in my case). The default boot manager in these ISO's fail to load on Intel Atom devices and one should resort to either rEFInd or syslinux as a boot manager. In addition a newer kernel version is required for proper HDMI audio support. This sounded like a daunting task to me, but <a href="http://linuxiumcomau.blogspot.com/">Linuxium</a> has made an amazing script named <em>isorespin.sh</em> that does most of the work. The complete package (but without the clean ISO), including some audio, WiFi and Bluetooth drivers, can be downloaded from <a href="https://ilaurens.stackstorage.com/s/E8cwo4BtIYnnJk2">here</a>. Simply put all the files in the folder and run from a root shell (<code>sudo -i</code>) the following:</p>
<div class="highlight"><pre><span></span># Make scripts executable
chmod u+x isorespin.sh linuxium-install-UCM-files.sh linuxium-install-broadcom-drivers.sh wrapper-linuxium-install-UCM-files.sh wrapper-linuxium-install-broadcom-drivers.sh

# Now for the actual respinning
./isorespin.sh -i ubuntu-17.04-desktop-amd64.iso -l rtl8723bs_4.12.0_amd64.deb -f linuxium-install-UCM-files.sh -f wrapper-linuxium-install-UCM-files.sh -f linuxium-install-broadcom-drivers.sh -f wrapper-linuxium-install-broadcom-drivers.sh -c wrapper-linuxium-install-UCM-files.sh -c wrapper-linuxium-install-broadcom-drivers.sh -s 256MB -k v4.11&#39;
</pre></div>


<p>Note however that the respinning is done on an Ubuntu distribution itself, as I found that spinning the ISO on an Lubuntu distro results in unbootable ISO's as well. I spare you from all the effort that goes into this spinning and instead offer you <a href="https://mega.nz/#!bM8hESrY">this image</a>. Make sure to <em>dd</em> this to an USB stick (again I recommend to use Ubuntu or a Ubuntu VM). The command should be <code>dd if=linuxium-persistence-v4.11-Ubuntu-17.04-desktop-amd64.iso of=\dev\sdX bs=4M</code>. Make sure to replace <code>sdX</code> with the correct reference to your USB device. After a succesfull copy simply boot the Live USB on your Intel Atom device (Press <em>F7</em> during for a boot menu) and start the installation.</p>
<h1>Making your fresh Ubuntu installation bootable</h1>
<p>If you try to boot your freshly installed OS from your internal storage, you will be sorely dissapointed. The OS is installed with the same erroneous bootloader that was present on the official ISO file. Yikes! We now need to change the boot configuration manually. Simply launch the Live USB again. We will simply recycle the rEFInd boot manager from the USB device (with some minor adjustments). The following commands will effectively copy the boot manager. Just make sure to replace <code>/dev/sda1</code> with the proper reference to the first partition of your USB device. Similarly, replace <code>/dev/mmcblk1p1</code> with the name for your internal storage's first partition.</p>
<div class="highlight"><pre><span></span># Create mountpoints for the EFI boot partitions of the internal storage and USB
mkdir /mnt/bootusb
mkdir /mnt/bootdisk
mount /dev/sda1 /mnt/bootusb
mount /dev/mmcblk1p1 /mnt/bootdisk

# Remove the existing files from the internal hard drive&#39;s EFI partition
rm -r /mnt/bootdisk
# Now copy the rEFInd bootloader from the USB to our internal storage
cp -r /mnt/bootusb/EFI /mnt/bootdisk

# Point the EFI boot system where to look for the new bootloader and make it the first boot option
efibootmgr -c -l \\EFI\\boot\\bootx64.efi -L rEFInd -d /dev/mmcblk1 -b 1234
efibootmgr -o 1234

# Now repair some rEFInd settings so that our system immediately boots the first OS it finds (Ubuntu). No graphics for more speed.
sed -i &#39;s/^scanfor manual$/scanfor internal/&#39; /mnt/bootdisk/EFI/boot/refind.conf
sed -i &#39;s/^timeout 20$/timeout -1/&#39; /mnt/bootdisk/EFI/boot/refind.conf
sed -i &#39;s/^#textonly$/textonly/&#39; /mnt/bootdisk/EFI/boot/refind.conf
</pre></div>


<p>After running these commands you can remove the USB stick and restart the device. That is all there is to it. Now you can experience the joy of Linux on your Intel Atom device!</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

                    var disqus_identifier = 'Ubuntu-on-Intel-Atom-Device';
                var disqus_url = 'https://blog.laurens.xyz/post/Ubuntu-on-Intel-Atom-Device.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Laurens
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.laurens.xyz/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.laurens.xyz/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.laurens.xyz/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iilaurens'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-77190701-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>